<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Painel ADM - ConfiguraÃ§Ãµes</title>
  <style>
    body{margin:0;font-family:Arial, sans-serif;background:#f9fafb}
    h1{margin:20px;font-size:22px}
    .grid{
      display:flex;gap:20px;flex-wrap:wrap;
      margin:20px;
    }
    .card{
      background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);
      width:150px;height:120px;display:flex;flex-direction:column;
      align-items:center;justify-content:center;cursor:pointer;
      position:relative;transition:.2s;
    }
    .card:hover{transform:scale(1.05)}
    .badge{
      position:absolute;top:8px;right:12px;
      background:#dc2626;color:#fff;font-size:12px;
      padding:2px 7px;border-radius:50%;
      display:none;
    }
    /* overlay fosco */
    .overlay{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;
    }
    .popup{
      background:#fff;padding:20px;border-radius:8px;max-width:800px;width:90%;max-height:90%;
      overflow:auto;box-shadow:0 6px 20px rgba(0,0,0,.25)
    }
    .fechar{float:right;cursor:pointer;font-size:18px}
  </style>
</head>
<body>
  <h1>ConfiguraÃ§Ãµes</h1>
  <div class="grid">
    <!-- CARD METAS -->
    <div class="card" onclick="abrirPopup('popupMetas')">
      ðŸ“Š<br>Metas
    </div>

    <!-- CARD CANCELAMENTOS -->
    <div class="card" onclick="abrirPopup('popupCancel')">
      <span class="badge" id="badgeCancel"></span>
      ðŸ§¾<br>Cancelamentos
    </div>
  </div>

  <!-- POPUP METAS -->
  <div class="overlay" id="popupMetas">
    <div class="popup">
      <span class="fechar" onclick="fecharPopup('popupMetas')">âœ–</span>
      <h2>Metas</h2>
      <iframe src="metas.html" style="width:100%;height:500px;border:none"></iframe>
    </div>
  </div>

  <!-- POPUP CANCELAMENTOS -->
  <div class="overlay" id="popupCancel">
    <div class="popup">
      <span class="fechar" onclick="fecharPopup('popupCancel')">âœ–</span>
      <h2>Cancelamentos</h2>
      <iframe src="cancelamentos.html" style="width:100%;height:500px;border:none"></iframe>
    </div>
  </div>

  <script>
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbzT5s59n8ymg3e8lptDNvMU8AIvlxm4czi5LLOikkttwRThb7HQrut_yxcPWYdzmEcV3g/exec";

    function abrirPopup(id){ document.getElementById(id).style.display="flex"; }
    function fecharPopup(id){ document.getElementById(id).style.display="none"; }

    async function carregarPendencias(){
      try{
        const res = await fetch(ENDPOINT+"?acao=statuscancelamentos");
        const js = await res.json();
        let totalPend=0;
        (js.companies||[]).forEach(c=> totalPend += (c.pendentes||[]).length );
        if(totalPend>0){
          const badge=document.getElementById("badgeCancel");
          badge.style.display="block";
          badge.textContent=totalPend;
        }
      }catch(err){
        console.error("Erro pendÃªncias:",err);
      }
    }

    carregarPendencias();
  </script>
</body>
</html>
